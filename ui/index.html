<!doctype html>
<html lang="en" ng-app="Sisy">
<head>
    <meta charset="utf-8"/>

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>

    <title>Sisy</title>

    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport'/>
    <meta name="viewport" content="width=device-width"/>


    <!-- Bootstrap core CSS     -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Animation library for notifications   -->
    <link href="assets/css/animate.min.css" rel="stylesheet"/>

    <!--  Paper Dashboard core CSS    -->
    <link href="assets/css/paper-dashboard.css" rel="stylesheet"/>


    <!--  CSS for Demo Purpose, don't include it in your project     -->
    <link href="assets/css/demo.css" rel="stylesheet"/>


    <!--  Fonts and icons     -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Muli:400,300' rel='stylesheet' type='text/css'>
    <link href="assets/css/themify-icons.css" rel="stylesheet">

</head>
<body ng-controller="SisyCtrl">

<div class="wrapper">
    <div class="sidebar" data-background-color="white" data-active-color="danger">

        <!--
            Tip 1: you can change the color of the sidebar's background using: data-background-color="white | black"
            Tip 2: you can change the color of the active button using the data-active-color="primary | info | success | warning | danger"
        -->

        <div class="sidebar-wrapper">
            <div class="logo">
                <a href="#" class="simple-text">
                    Sisy<br/>

                </a>
            </div>

            <ul class="nav">
                <li class="">
                    <a href="index.html">
                        <i class="ti-view-list-alt"></i>
                        <p>Dashboard</p>
                    </a>
                </li>
                <li ng-repeat="file in experimentFiles">
                    <a href="#" ng-click="selectFile($index)">
                        <i style="color: #68B3C8;" class="ti-file"></i>
                        <p>{{file.name}}</p>
                    </a>
                </li>
                <!--<li>-->
                    <!--<a href="icons.html">-->
                        <!--<i class="ti-pencil-alt2"></i>-->
                        <!--<p>Icons</p>-->
                    <!--</a>-->
                <!--</li>-->

            </ul>
        </div>
    </div>

    <div class="main-panel">
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar bar1"></span>
                        <span class="icon-bar bar2"></span>
                        <span class="icon-bar bar3"></span>
                    </button>
                    <a class="navbar-brand" href="#">{{experimentName}} - Evolution {{evolutionNumber}}</a>
                </div>
                <!--<div class="collapse navbar-collapse">-->
                <!--<ul class="nav navbar-nav navbar-right">-->
                <!--<li>-->
                <!--<a href="#" class="dropdown-toggle" data-toggle="dropdown">-->
                <!--<i class="ti-panel"></i>-->
                <!--<p>Stats</p>-->
                <!--</a>-->
                <!--</li>-->
                <!--<li class="dropdown">-->
                <!--<a href="#" class="dropdown-toggle" data-toggle="dropdown">-->
                <!--<i class="ti-bell"></i>-->
                <!--<p class="notification">5</p>-->
                <!--<p>Notifications</p>-->
                <!--<b class="caret"></b>-->
                <!--</a>-->
                <!--<ul class="dropdown-menu">-->
                <!--<li><a href="#">Notification 1</a></li>-->
                <!--<li><a href="#">Notification 2</a></li>-->
                <!--<li><a href="#">Notification 3</a></li>-->
                <!--<li><a href="#">Notification 4</a></li>-->
                <!--<li><a href="#">Another notification</a></li>-->
                <!--</ul>-->
                <!--</li>-->
                <!--<li>-->
                <!--<a href="#">-->
                <!--<i class="ti-settings"></i>-->
                <!--<p>Settings</p>-->
                <!--</a>-->
                <!--</li>-->
                <!--</ul>-->

                <!--</div>-->
            </div>
        </nav>


        <div class="content">
            <div class="container-fluid">
                <div class="row">

                    <div class="col-lg-3 col-sm-6" ng-show="experimentData.length">
                        <div class="card">
                            <div class="content">
                                <div class="row">
                                    <div class="col-xs-5">
                                        <div class="icon-big icon-warning text-center">
                                            <i class="ti-more-alt"></i>
                                        </div>
                                    </div>
                                    <div class="col-xs-7">
                                        <div class="numbers">
                                            <p>Networks Tested/Population</p>
                                            {{layoutCount}}
                                        </div>
                                    </div>
                                </div>
                                <div class="footer">
                                    <hr/>
                                    <div class="stats">
                                        {{startScore}} <i class="ti-angle-double-right"></i> {{endScore}}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-sm-6" ng-show="experimentData.length">
                                          <div class="card">
                                              <div class="content">
                                                  <div class="row">
                                                      <div class="col-xs-5" style="transform: rotate(180deg)">
                                                          <div class="icon-big text-center" style="color: darkblue;">
                                                              <i class="ti-split-v" ></i>
                                                          </div>
                                                      </div>
                                                      <div class="col-xs-7">
                                                          <div class="numbers">
                                                              <p>Low Score</p>
                                                              {{startScore}}
                                                          </div>
                                                      </div>
                                                  </div>
                                                  <div class="footer">
                                                      <hr/>
                                                      <div class="stats">
                                                      </div>
                                                  </div>
                                              </div>
                                          </div>
                                      </div>
                    <div class="col-lg-3 col-sm-6" ng-show="experimentData.length">
                                          <div class="card">
                                              <div class="content">
                                                  <div class="row">
                                                      <div class="col-xs-5">
                                                          <div class="icon-big icon-danger text-center"  style="color: darkblue;">
                                                              <i class="ti-split-v" ></i>
                                                          </div>
                                                      </div>
                                                      <div class="col-xs-7">
                                                          <div class="numbers">
                                                              <p>High Score</p>
                                                              {{endScore}}
                                                          </div>
                                                      </div>
                                                  </div>
                                                  <div class="footer">
                                                      <hr/>
                                                      <div class="stats">
                                                      </div>
                                                  </div>
                                              </div>
                                          </div>
                                      </div>
                    <div class="col-lg-3 col-sm-6" ng-show="experimentData.length">
                        <div class="card">
                            <div class="content">
                                <div class="row">
                                    <div class="col-xs-5">
                                        <div class="icon-big  text-center" style="color: background-color: darkgreen;">
                                            <i class="ti-pulse"></i>
                                        </div>
                                    </div>
                                    <div class="col-xs-7">
                                        <div class="numbers">
                                            <p>Average</p>
                                            {{average}}
                                        </div>
                                    </div>
                                </div>
                                <div class="footer">
                                    <hr/>
                                    <div class="stats">
                                        <i class="ti-timer"></i> {{averageRunTime}} minutes per run.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-sm-6" ng-hide="experimentData.length">
                        <div class="card">
                            <div class="content">
                                <div class="row">
                                    <div class="col-xs-5">
                                        <div class="icon-big text-center">
                                            <i class="ti-file"></i>
                                        </div>
                                    </div>
                                    <div class="col-xs-7">
                                        <div class="numbers">
                                            <p>Please select an experiment</p>
                                            <label for="fileToUpload">Select a directory</label><br/>
                                            <!--<input type="file" webkitdirectory>-->
                                            <input type="file" ng-model-instant id="fileToUpload" multiple
                                                   onchange="angular.element(this).scope().setFiles(this)"
                                                   webkitdirectory/>
                                        </div>
                                    </div>
                                </div>
                                <div class="footer">
                                    <hr/>
                                    <div class="stats">

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
                <div class="row">

                    <div class="col-md-12" ng-show="experimentLog">
                        <div class="card">
                            <div class="header">
                                <h4 class="title">Experiment Log</h4>
                                <p class="category">Text log file</p>
                            </div>
                            <div class="content" ng-bind-html="experimentLog">
                                <!--{{experimentLog}}-->
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="card">
                            <div class="header">
                                <h4 class="title">Generation {{evolutionNumber}} Scores</h4>
                                <p class="category">{{layoutCount}} generations</p>
                            </div>
                            <div class="content">
                                <div id="chartActivity" class="ct-chart"></div>
                                <div class="footer">
                                    <div class="chart-legend">
                                        <i class="fa fa-circle text-info"></i> Score
                                        <i class="fa ti-layout-line-solid"></i>Generation Group
                                    </div>
                                    <hr>
                                    <div class="stats">
                                        <i class="ti-reload"></i> Last ran on 2017-06-06 21:39
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="container-fluid">
                <div class="row">


                    <div class="col-md-12">
                        <div class="card card-plain">
                            <div class="header">
                                <h4 class="title">Network Layouts</h4>
                                <p class="category">.</p>
                            </div>
                            <div class="content table-responsive table-full-width">
                                <table class="table table-hover">
                                    <thead>
                                    <th>ID</th>

                                    <th>Score</th>
                                    <th>Objective/Loss</th>
                                    <th>Metric</th>
                                    <th>Optimizer</th>
                                    <th>Layout</th>
                                    </thead>
                                    <tbody>
                                    <tr ng-repeat="row in experimentData track by $index">
                                        <td>{{$index}}</td>
                                        <td>{{row.score[0]}}</td>
                                        <td>{{row.training.objective.objective}}</td>
                                        <td>{{row.training.metric.metric}}</td>
                                        <td>{{row.training.optimizer.optimizer}}</td>
                                        <td>
                                            <div ng-repeat="sisy_row in row.layout.rows">
                                                <div ng-repeat="block in sisy_row.blocks">
                                                    <!--<div ng-repeat="block in blocks" >-->

                                                        <div style="background-color: white;padding: 5px;border-radius: 5px;font-size: 1.2em;">
                                                        &nbsp;&nbsp;Input({{row.layout.input_size}})->
                                                        <div style="display: inline;" ng-repeat="layer in block.layers">
                                                            {{layer.layer_type}}({{layer.parameters.units || layer.parameters.rate.toFixed(2)}})->
                                                        </div>
                                                        Output({{row.layout.output_size}})
                                                        </div>
                                                        <br>&nbsp;<br>
                                                        <div ng-repeat="layer in block.layers">
                                                            -{{layer.layer_type}}({{layer.parameters.units}}) :
                                                            <pre>{{layer.parameters}}</pre>
                                                        </div>
                                                        </div>
                                                -Output({{row.layout.output_size}}) <pre>output_activation : {{row.layout.output_activation}} , {{row.layout.output_initializer}} </pre>
                                                        </div>

                                                    <!--</div>-->
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>

                            </div>
                        </div>
                    </div>


                </div>
            </div>

        </div>


        <footer class="footer">
            <div class="container-fluid">
                <nav class="pull-left">
                    <ul>

                        <li>
                            <a href="https://github.com/guybedo/sisy">
                                Github Link
                            </a>
                        </li>

                    </ul>
                </nav>
            </div>
        </footer>

    </div>
</div>


</body>

<!--   Core JS Files   -->
<script src="assets/js/jquery-1.10.2.js" type="text/javascript"></script>
<script src="assets/js/bootstrap.min.js" type="text/javascript"></script>

<!--  Checkbox, Radio & Switch Plugins -->
<script src="assets/js/bootstrap-checkbox-radio.js"></script>

<!--  Charts Plugin -->
<script src="assets/js/chartist.min.js"></script>

<!--  Notifications Plugin    -->
<script src="assets/js/bootstrap-notify.js"></script>


<!-- Paper Dashboard Core javascript and methods for Demo purpose -->
<script src="assets/js/paper-dashboard.js"></script>

<!-- Paper Dashboard DEMO methods, don't include it in your project! -->
<!--<script src="assets/js/demo.js"></script>-->

<script type="text/javascript">
    var Events = {};
    function handleFileSelect(evt) {
        var files = evt.target.files; // FileList object

        // Loop through the FileList and render image files as thumbnails.
        for (var i = 0, f; f = files[i]; i++) {


            var reader = new FileReader();

            // Closure to capture the file information.
            reader.onload = (function (theFile) {
                return function (e) {
                    Events.trigger('fileRead', e.target.result);
                };
            })(f);

            // Read in the image file as a data URL.
            reader.readAsText(f);
        }
    }


    //    document.getElementById('files').addEventListener('change', handleFileSelect, false);

    $(document).ready(function () {
        _.extend(Events, Backbone.Events);

//
        angular.module('Sisy', ['ngSanitize']).controller('SisyCtrl', ['$scope', function ($scope) {


            $scope.experimentData = [];


            $scope.selectFile = function (index) {
                var f = $scope.experimentFiles[index]


                var reader = new FileReader();

                // Closure to capture the file information.
                reader.onload = (function (theFile) {
                    return function (e) {
                        Events.trigger('fileRead', f.name, e.target.result);
                    }
                })(f);

                // Read in the image file as a data URL.
                reader.readAsText(f);
            }

            $scope.setFiles = function (element) {
                $scope.$apply(function (scope) {
                    // Turn the FileList object into an Array
                    var files = []
                    var experimentName = ''
                    for (var i = 0; i < element.files.length; i++) {

                        if (element.files[i].name.endsWith(".log")) {

                            var file = element.files[i];
                            experimentName = _.words(file.webkitRelativePath, "/")[0]
                            console.log(experimentName)
                            files.push(file)

                        }
                    }
                    console.log('files:', files)
                    files.sort(function (l, r) {
                        if (l.name.toLowerCase() == "experiment.log") return -1;
                        return parseInt(_.words(l.name, ".")[2]) < parseInt(_.words(r.name, ".")[2]) ? -1 : 1
                    });

                    console.log('files:', files)
                    $scope.experimentName = experimentName
                    $scope.experimentFiles = files
                    scope.progressVisible = false
                });
            }
            Events.on("fileRead", function (fileName, fileContents) {


                if (fileName.toLowerCase() == "experiment.log") {
                                $scope.$apply(function (scope) {
                                $scope.experimentLog = fileContents.replace(/(?:\r\n|\r|\n)/g, '<br />');
                    });

                    return;
                }
                else {

                    $scope.experimentLog = false;
                    <!--var hiddenElement = document.createElement('a');-->

                    <!--hiddenElement.href = 'data:attachment/text,' + encodeURI(fileContents);-->
                    <!--hiddenElement.target = '_blank';-->
                    <!--hiddenElement.download = 'myFile.txt';-->
                    <!--hiddenElement.click();-->
                    $scope.experimentData = JSON.parse(fileContents)
                    window.data = $scope.experimentData.reverse()

                    $scope.layoutCount = $scope.experimentData.length

                    var scores = _.map($scope.experimentData, function (item) {

                        return item.score[0]
                    });


                    var labels = _.map($scope.experimentData, function (item, index) {
                        return String(index)
                    })


                    if ($scope.experimentData.length) {

                        $scope.evolutionNumber = _.words(fileName,'.')[2]
                        $scope.startScore = scores[0].toFixed(4)
                        $scope.endScore = scores[scores.length - 1].toFixed(4)
                        $scope.improvement = ($scope.endScore - $scope.startScore)
                        var scoreSum = _.reduce(scores, function(memo, num){ return memo + num; }, 0);
                        $scope.average =(scoreSum / scores.length).toFixed(4)

                        var chartData = {
                            labels: labels,
                            series: [
                                scores
                            ]
                        };

                        var options = {
                            seriesBarDistance: 10,
                            axisX: {
                                showGrid: false
                            },
                            height: "245px"

                        };

                        var responsiveOptions = [
                            ['screen and (max-width: 640px)', {
                                seriesBarDistance: 5,
                                axisX: {
                                    labelInterpolationFnc: function (value) {
                                        return value[0];
                                    }
                                }
                            }]
                        ];

                        $scope.averageRunTime = 92.34;

                        $scope.wasHigher = function (index) {
                            return index;
                        }

                        Chartist.Line('#chartActivity', chartData, options, responsiveOptions);

                        $scope.$apply();
                    }
                }
            });

        }]);

    });

</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.5/angular.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.5/angular-sanitize.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.string/3.3.4/underscore.string.js"></script>
<script>
    _.mixin(s.exports());
</script>
<script src="http://backbonejs.org/backbone-min.js"></script>

</html>
